import chalk from 'chalk'
import { EnvUtils } from '../../util/env'
import { LogLevel, Logger } from './logger.types'

interface Web5jsDevelopmentLoggerOptions {
  welcome: boolean
  level: LogLevel
}

export class Web5jsDevelopmentLogger implements Logger {
  private static readonly DISABLE_WELCOME = '__TTM_DISABLE_WELCOME__'
  private static isWelcomeDisabled(): boolean {
    const anyGlobal = globalThis as unknown as { __TTM_DISABLE_WELCOME__: boolean }
    return !!anyGlobal[Web5jsDevelopmentLogger.DISABLE_WELCOME]
  }

  private static disableWelcome(): void {
    const anyGlobal = globalThis as unknown as { __TTM_DISABLE_WELCOME__: boolean }
    anyGlobal[Web5jsDevelopmentLogger.DISABLE_WELCOME] = true
  }

  private readonly options: Web5jsDevelopmentLoggerOptions
  private readonly logger = console

  private readonly _trace = chalk.gray
  private readonly _debug = chalk.gray
  private readonly _info = chalk.white
  private readonly _warn = chalk.bold.yellow
  private readonly _error = chalk.bold.red

  private readonly _DEBUG = chalk.bgGray.white(' DEBUG ')
  private readonly _INFO = chalk.bgCyan.gray(' INFO ')
  private readonly _WARN = chalk.bgYellowBright.black(' WARN ')
  private readonly _ERROR = chalk.bgRedBright.bold.yellow(' ERROR ')

  constructor(options: Partial<Web5jsDevelopmentLoggerOptions> = {}) {
    const defaultOptions: Web5jsDevelopmentLoggerOptions = {
      welcome: EnvUtils.isDevelopment() && !Web5jsDevelopmentLogger.isWelcomeDisabled(),
      level: LogLevel.INFO,
    }

    this.options = { ...defaultOptions, ...options }

    if (this.options.welcome) {
      this.welcome()
      Web5jsDevelopmentLogger.disableWelcome()
    }
  }

  private welcome(): void {
    this.logger.log([LOGO, WELCOME_MESSAGES[Math.floor(Math.random() * WELCOME_MESSAGES.length)]].join('\n'))
  }

  trace(...args: unknown[]): void {
    if (this.options.level > LogLevel.TRACE) return
    this.logger.trace(this._trace(...args))
  }

  debug(...args: unknown[]): void {
    if (this.options.level > LogLevel.DEBUG) return
    this.logger.debug(this._DEBUG, this._debug(...args))
  }

  info(...args: unknown[]): void {
    if (this.options.level > LogLevel.INFO) return
    this.logger.info(this._INFO, this._info(...args))
  }

  warn(...args: unknown[]): void {
    if (this.options.level > LogLevel.WARN) return
    this.logger.warn(this._WARN, this._warn(...args))
  }

  error(...args: unknown[]): void {
    if (this.options.level > LogLevel.ERROR) return
    this.logger.error(this._ERROR, this._error(...args))
  }
}

const LOGO = `--------------------------------------------------------------------------------
                              
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;79mt[39m[38;5;79mt[39m[38;5;79mL[39m[38;5;79mL[39m[38;5;79mL[39m[38;5;79mL[39m[38;5;79mL[39m[38;5;79mL[39m[38;5;79mL[39m[38;5;79mL[39m[38;5;79mf[39m[38;5;79mf[39m[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;99mf[39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99m1[39m[38;5;99m1[39m[38;5;79mt[39m[38;5;79mt[39m[38;5;79mL[39m[38;5;79mL[39m[38;5;79mL[39m[38;5;79mL[39m[38;5;79mL[39m[38;5;79mL[39m[38;5;79mL[39m[38;5;79mL[39m[38;5;79mf[39m[38;5;79mf[39m[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m
[38;5;99mL[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99m1[39m[38;5;99m1[39m[38;5;79m1[39m[38;5;79m1[39m[38;5;79mf[39m[38;5;79mf[39m[38;5;79mf[39m[38;5;79mf[39m[38;5;79mf[39m[38;5;79mf[39m[38;5;79mf[39m[38;5;79mf[39m[38;5;79mt[39m[38;5;79mt[39m[39m[38;5;60m [39m[38;5;60m [39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;16m [39m[38;5;16m [39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;16m [39m[38;5;16m [39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;16m [39m[38;5;16m [39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m,[39m
[38;5;99mf[39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mt[39m[38;5;99mt[39m[38;5;99m1[39m[38;5;99m1[39m[38;5;99m1[39m[38;5;99m1[39m[38;5;99mi[39m[38;5;99mi[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[39m[38;5;60m [39m[38;5;60m [39m[38;5;60m:[39m[38;5;60m:[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60m:[39m[38;5;60m:[39m[38;5;16m [39m[38;5;16m [39m[38;5;60m:[39m[38;5;60m:[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;16m [39m[38;5;16m [39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60m:[39m[38;5;60m:[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60m:[39m[38;5;60m:[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;16m [39m[38;5;16m [39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60m:[39m[38;5;60m:[39m[38;5;60mi[39m[38;5;60mi[39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99m1[39m[38;5;99m1[39m[38;5;60m [39m[38;5;60m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60m:[39m[38;5;60m:[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60m:[39m[38;5;60m:[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60m:[39m[38;5;60m:[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;16m [39m[38;5;16m [39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60m:[39m[38;5;60m:[39m[38;5;16m [39m[38;5;16m [39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60mi[39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99m1[39m[38;5;99m1[39m[38;5;60m [39m[38;5;60m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60m:[39m[38;5;60m:[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60m:[39m[38;5;60m:[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60m:[39m[38;5;60m:[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60m:[39m[38;5;60m:[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;16m [39m[38;5;16m [39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60m:[39m[38;5;60m:[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60mi[39m[38;5;60mi[39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99m1[39m[38;5;99m1[39m[38;5;60m [39m[38;5;60m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60m:[39m[38;5;60m:[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60m:[39m[38;5;60m:[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60m:[39m[38;5;60m:[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60m:[39m[38;5;60m:[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;16m [39m[38;5;16m [39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60m:[39m[38;5;60m:[39m[38;5;60mi[39m[38;5;60mi[39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99m1[39m[38;5;99m1[39m[38;5;60m [39m[38;5;60m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;16m [39m[38;5;16m [39m[38;5;60m:[39m[38;5;60m:[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60m:[39m[38;5;60m:[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60m:[39m[38;5;60m:[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;16m [39m[38;5;16m [39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m,[39m[38;5;60m,[39m[38;5;60mi[39m[38;5;60mi[39m
[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;99mf[39m[38;5;99mf[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99mL[39m[38;5;99m1[39m[38;5;99m1[39m[38;5;60m [39m[38;5;60m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60m:[39m[38;5;60m:[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m:[39m[38;5;60m:[39m[38;5;16m [39m[38;5;16m [39m[38;5;60m:[39m[38;5;60m:[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;16m [39m[38;5;60m:[39m[38;5;60m:[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60mi[39m[38;5;60m:[39m[38;5;60m:[39m[38;5;16m [39m[38;5;16m [39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;16m [39m[38;5;16m [39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m;[39m[38;5;60m [39m[38;5;60m [39m[38;5;60m,[39m[38;5;60mi[39m[38;5;60mi[39m
            
--------------------------------------------------------------------------------`

const WELCOME = 'Hi! 👋 Welcome to Web5js, the Javascript SDK for Web3.'

const WELCOME_MESSAGES = [
  `
              ${WELCOME}

      Visit our docs to see how Web5js will help you launch projects fast:
                             ${chalk.blueBright('https://docs.web5.nexus')}
  `,
  `
              ${WELCOME}

                    Kick start by making your first RPC call:
                            ${chalk.blueBright('https://docs.web5.nexus')}
  `,
  `
              ${WELCOME}

        Possibilities are endless - see what apps you can build with Web5js:
                             ${chalk.blueBright('https://docs.web5.nexus')}
  `,
  `
              ${WELCOME}
                          
    ${chalk.bold('FREE Testnet Tokens')}: Explore Web5js's Faucets available for over 5 chains: 
                           ${chalk.blueBright('https://docs.web5.nexus')}
`,
]
